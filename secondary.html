<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–í—ã–∫–ª–∞–¥–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π - –í—Ç–æ—Ä–∏—á–Ω–æ–µ –∂–∏–ª—å—ë</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
--primary: #1E3A8A;
--primary-dark: #172554;
--secondary: #BFDBFE;
--accent: #D4AF37;
--text: #000000;
--bg: #F5F7FA;
--border: #E2E8F0;
--text-secondary: #64748B;
--shadow-sm: 0 2px 8px rgba(30, 58, 138, 0.08);
--shadow-md: 0 6px 16px rgba(30, 58, 138, 0.12);
--shadow-lg: 0 12px 28px rgba(30, 58, 138, 0.18);
--transition: cubic-bezier(0.22, 0.61, 0.36, 1);
}
body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
display: flex;
justify-content: center;
align-items: center;
padding: 20px;
}
.container {
max-width: 800px;
width: 100%;
background: white;
border-radius: 20px;
box-shadow: var(--shadow-lg);
overflow: hidden;
}
.header {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
padding: 40px;
text-align: center;
}
.header h1 {
font-size: 32px;
margin-bottom: 10px;
}
.header p {
opacity: 0.9;
font-size: 16px;
}
.login-form, .property-form, .my-properties-form {
padding: 40px;
}
.form-group {
margin-bottom: 24px;
}
.form-group label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: var(--text);
font-size: 15px;
}
.form-control {
width: 100%;
padding: 14px 16px;
border: 2px solid var(--border);
border-radius: 12px;
font-size: 15px;
transition: all 0.3s;
font-family: 'Inter', sans-serif;
}
.form-control:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.1);
}
.form-control[type="file"] {
padding: 3px;
}
textarea.form-control {
min-height: 120px;
resize: vertical;
}
.btn {
padding: 14px 28px;
border: none;
border-radius: 12px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
display: inline-flex;
align-items: center;
justify-content: center;
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
box-shadow: var(--shadow-md);
width: 100%;
}
.btn:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-lg);
}
.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
transform: none;
}
.btn-secondary {
background: linear-gradient(135deg, #64748b, #475569);
}
.btn-success {
background: linear-gradient(135deg, #10b981, #059669);
}
.btn-warning {
background: linear-gradient(135deg, #f59e0b, #d97706);
}
.hidden {
display: none;
}
.alert {
padding: 16px 20px;
border-radius: 12px;
margin-bottom: 20px;
font-weight: 500;
display: flex;
align-items: center;
gap: 12px;
}
.alert-success {
background: #dcfce7;
color: #059669;
border-left: 4px solid #10b981;
}
.alert-error {
background: #fee2e2;
color: #dc2626;
border-left: 4px solid #ef4444;
}
.alert-info {
background: #dbeafe;
color: #1e40af;
border-left: 4px solid #3b82f6;
}
.form-row {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin-bottom: 20px;
}
@media (max-width: 768px) {
.form-row {
grid-template-columns: 1fr;
}
.header {
padding: 30px 20px;
}
.header h1 {
font-size: 24px;
}
.login-form, .property-form, .my-properties-form {
padding: 30px 20px;
}
}
.upload-progress-container {
background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
border-radius: 12px;
padding: 20px;
margin: 20px 0;
border: 2px solid var(--primary);
box-shadow: var(--shadow-sm);
display: none;
}
.progress-bar-outer {
width: 100%;
background: #e2e8f0;
border-radius: 20px;
height: 28px;
overflow: hidden;
margin-bottom: 12px;
box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}
.progress-bar-inner {
height: 100%;
background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
border-radius: 20px;
width: 0%;
transition: width 0.1s ease;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 600;
font-size: 14px;
}
.upload-status {
font-size: 14px;
color: var(--text-secondary);
margin-top: 10px;
display: flex;
align-items: center;
gap: 8px;
}
.photo-preview {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
gap: 12px;
margin-top: 16px;
}
.photo-item {
position: relative;
width: 100%;
height: 120px;
border-radius: 10px;
overflow: hidden;
border: 2px solid var(--border);
}
.photo-item img {
width: 100%;
height: 100%;
object-fit: cover;
}
.photo-remove {
position: absolute;
top: 4px;
right: 4px;
width: 24px;
height: 24px;
background: rgba(239, 68, 68, 0.9);
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
border: none;
font-size: 16px;
}
.logo {
width: 80px;
height: 80px;
margin: 0 auto 20px;
background: var(--accent);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 32px;
font-weight: bold;
color: white;
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.success-card {
text-align: center;
padding: 60px 20px;
}
.success-icon {
width: 80px;
height: 80px;
margin: 0 auto 24px;
background: #dcfce7;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: #059669;
font-size: 48px;
font-weight: bold;
}
.properties-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
gap: 20px;
margin-top: 20px;
}
.property-card {
background: white;
border-radius: 12px;
overflow: hidden;
box-shadow: var(--shadow-sm);
transition: transform 0.3s;
border: 2px solid var(--border);
}
.property-card:hover {
transform: translateY(-5px);
box-shadow: var(--shadow-md);
border-color: var(--primary);
}
.property-image {
height: 180px;
background-size: cover;
background-position: center;
}
.property-info {
padding: 15px;
}
.property-title {
font-weight: 700;
font-size: 16px;
margin-bottom: 8px;
color: var(--primary);
}
.property-price {
color: #10b981;
font-weight: 600;
margin-bottom: 5px;
}
.property-address {
color: var(--text-secondary);
font-size: 13px;
margin-bottom: 10px;
}
.property-district {
display: inline-block;
background: #f0f4f8;
color: var(--primary);
padding: 4px 10px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
margin-bottom: 8px;
}
.property-shifr {
font-size: 12px;
font-weight: 700;
color: var(--text-secondary);
margin-bottom: 8px;
}
.property-actions {
display: flex;
gap: 8px;
margin-top: 10px;
}
.property-actions .btn {
width: auto;
padding: 10px 16px;
font-size: 14px;
}
.tabs {
display: flex;
gap: 10px;
margin-bottom: 30px;
background: white;
padding: 10px;
border-radius: 12px;
box-shadow: var(--shadow-sm);
}
.tab-btn {
padding: 12px 24px;
background: white;
border: none;
border-radius: 10px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
box-shadow: var(--shadow-sm);
}
.tab-btn:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-lg);
}
.tab-btn.active {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
}
</style>
</head>
<body>
<div class="container" id="login-container">
<div class="header">
<div class="logo">üè†</div>
<h1>–í—ã–∫–ª–∞–¥–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h1>
<p>–í—Ç–æ—Ä–∏—á–Ω–æ–µ –∂–∏–ª—å—ë ‚Äî –¥–æ–º–∞ –∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã</p>
</div>
<div class="login-form">
<div id="login-alert"></div>
<div class="form-group">
<label for="login-username">–õ–æ–≥–∏–Ω</label>
<input type="text" id="login-username" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" autocomplete="username">
</div>
<div class="form-group">
<label for="login-password">–ü–∞—Ä–æ–ª—å</label>
<input type="password" id="login-password" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="current-password">
</div>
<button class="btn" onclick="login()">–í–æ–π—Ç–∏</button>
</div>
</div>

<div class="container hidden" id="main-container">
<div class="header">
<div class="logo">üìù</div>
<h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
<p>–í—Ç–æ—Ä–∏—á–Ω–æ–µ –∂–∏–ª—å—ë</p>
</div>
<div class="tabs">
<button class="tab-btn active" onclick="showTab('create')">‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
<button class="tab-btn" onclick="showTab('my-properties')">üìã –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</button>
<button class="tab-btn" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
</div>

<div id="create-tab" class="property-form">
<div id="property-alert"></div>
<form id="secondary-form" enctype="multipart/form-data">
<div class="form-group">
<label>–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ *</label>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
<button type="button" class="btn" id="type-apartment" onclick="selectType('apartment')">–ö–≤–∞—Ä—Ç–∏—Ä–∞</button>
<button type="button" class="btn btn-secondary" id="type-house" onclick="selectType('house')">–î–æ–º</button>
</div>
<input type="hidden" name="type" id="property-type" value="apartment" required>
</div>

<div class="form-group">
<label>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —à–∏—Ñ—Ä (–∫–æ–¥) *</label>
<input type="text" class="form-control" name="property_number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IVANOV123, PETROV456" required>
<small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 6px;">
üí° –≠—Ç–æ—Ç —à–∏—Ñ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
</small>
</div>

<div class="form-row">
<div class="form-group">
<label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
<input type="text" class="form-control" name="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2-–∫–æ–º–Ω. –∫–≤–∞—Ä—Ç–∏—Ä–∞ —É –º–µ—Ç—Ä–æ" required>
</div>
<div class="form-group">
<label>–¶–µ–Ω–∞ *</label>
<input type="text" class="form-control" name="price" placeholder="–æ—Ç 12 300 000 ‚ÇΩ" required>
</div>
</div>

<div class="form-group">
<label>–†–∞–π–æ–Ω *</label>
<input type="text" class="form-control" name="district" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π, –ö–∏—Ä–æ–≤—Å–∫–∏–π" required>
<small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 6px;">
–≠—Ç–æ—Ç —Ä–∞–π–æ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ñ–∏–ª—å—Ç—Ä —Ä–∞–π–æ–Ω–æ–≤
</small>
</div>

<div class="form-group">
<label>–ê–¥—Ä–µ—Å *</label>
<input type="text" class="form-control" name="address" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, 42, –ú–æ—Å–∫–≤–∞" required>
</div>

<div class="form-group">
<label>–û–ø–∏—Å–∞–Ω–∏–µ *</label>
<textarea class="form-control" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞..." required></textarea>
</div>

<div class="form-group">
<label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 50 —Ñ–∞–π–ª–æ–≤) *</label>
<input type="file" class="form-control" id="images-input" name="images" multiple accept="image/*" required onchange="previewFiles()">
<small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 6px;">
–ú–∞–∫—Å–∏–º—É–º 50 —Ñ–æ—Ç–æ, –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –¥–æ 5 –ú–ë
</small>
</div>

<div id="photo-preview" class="photo-preview"></div>

<div id="upload-progress-container" class="upload-progress-container">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
<div style="font-weight: 700; color: var(--primary);">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π...</div>
<div id="progress-percentage" style="font-weight: 700; color: var(--primary);">0%</div>
</div>
<div class="progress-bar-outer">
<div class="progress-bar-inner" id="progress-bar-inner" style="width: 0%">0%</div>
</div>
<div class="upload-status" id="upload-status">
–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ...
</div>
</div>

<button type="submit" id="submit-btn" class="btn">
‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
</button>
</form>
</div>

<div id="my-properties-tab" class="my-properties-form hidden">
<div id="properties-alert"></div>
<div id="properties-list" class="properties-grid"></div>
<div id="no-properties" class="success-card" style="display: none;">
<div class="success-icon">üìã</div>
<h2 style="font-size: 24px; margin-bottom: 16px; color: var(--text);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h2>
<p style="color: var(--text-secondary); margin-bottom: 24px; line-height: 1.6;">
–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
</p>
<button class="btn" onclick="showTab('create')">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
</div>
</div>
</div>

<script>
const API_BASE = 'http://localhost:5000/api';
let authToken = localStorage.getItem('auth_token');
let selectedFiles = [];
let selectedType = 'apartment';
let currentUser = null;

if (authToken) {
verifyAuth();
} else {
showLoginForm();
}

function showLoginForm() {
document.getElementById('login-container').classList.remove('hidden');
document.getElementById('main-container').classList.add('hidden');
}

function showMainContainer() {
document.getElementById('login-container').classList.add('hidden');
document.getElementById('main-container').classList.remove('hidden');
loadMyProperties();
}

function showTab(tab) {
document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
document.querySelectorAll('.property-form, .my-properties-form').forEach(el => el.classList.add('hidden'));
if (tab === 'create') {
document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
document.getElementById('create-tab').classList.remove('hidden');
} else if (tab === 'my-properties') {
document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
document.getElementById('my-properties-tab').classList.remove('hidden');
loadMyProperties();
}
}

async function verifyAuth() {
try {
const response = await fetch(`${API_BASE}/auth/verify`, {
method: 'POST',
headers: {
'Authorization': `Bearer ${authToken}`
}
});
const data = await response.json();
if (data.success) {
currentUser = data.user;
showMainContainer();
} else {
authToken = null;
localStorage.removeItem('auth_token');
showLoginForm();
}
} catch (error) {
authToken = null;
localStorage.removeItem('auth_token');
showLoginForm();
}
}

async function login() {
const username = document.getElementById('login-username').value.trim();
const password = document.getElementById('login-password').value.trim();

if (!username || !password) {
showAlert('login-alert', '–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
return;
}

try {
const response = await fetch(`${API_BASE}/auth/login`, {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify({ username, password })
});

const data = await response.json();

if (data.success) {
authToken = data.token;
currentUser = data.user;
localStorage.setItem('auth_token', authToken);
showAlert('login-alert', '–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!', 'success');
setTimeout(() => {
showMainContainer();
document.getElementById('login-alert').innerHTML = '';
}, 1000);
} else {
showAlert('login-alert', data.message || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'error');
}
} catch (error) {
console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
showAlert('login-alert', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
}
}

function logout() {
authToken = null;
currentUser = null;
localStorage.removeItem('auth_token');
showLoginForm();
}

function showAlert(elementId, message, type) {
const element = document.getElementById(elementId);
const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-error' : 'alert-info';
const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ÑπÔ∏è';
element.innerHTML = `<div class="alert ${alertClass}">${icon} ${message}</div>`;
setTimeout(() => {
element.innerHTML = '';
}, 5000);
}

function selectType(type) {
selectedType = type;
document.getElementById('property-type').value = type;
const apartmentBtn = document.getElementById('type-apartment');
const houseBtn = document.getElementById('type-house');
if (type === 'apartment') {
apartmentBtn.classList.remove('btn-secondary');
houseBtn.classList.add('btn-secondary');
} else {
apartmentBtn.classList.add('btn-secondary');
houseBtn.classList.remove('btn-secondary');
}
}

function previewFiles() {
const filesInput = document.getElementById('images-input');
const previewContainer = document.getElementById('photo-preview');
selectedFiles = Array.from(filesInput.files);
previewContainer.innerHTML = '';

if (selectedFiles.length > 50) {
showAlert('property-alert', '–ú–∞–∫—Å–∏–º—É–º 50 —Ñ–æ—Ç–æ!', 'error');
filesInput.value = '';
selectedFiles = [];
return;
}

const maxSize = 5 * 1024 * 1024;
const tooLargeFiles = selectedFiles.filter(file => file.size > maxSize);
if (tooLargeFiles.length > 0) {
showAlert('property-alert', `–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ! –ú–∞–∫—Å–∏–º—É–º 5 –ú–ë –Ω–∞ —Ñ–∞–π–ª.`, 'error');
filesInput.value = '';
selectedFiles = [];
return;
}

selectedFiles.forEach((file, index) => {
const reader = new FileReader();
reader.onload = function(e) {
const photoItem = document.createElement('div');
photoItem.className = 'photo-item';
photoItem.innerHTML = `
<img src="${e.target.result}" alt="–§–æ—Ç–æ">
<button class="photo-remove" onclick="removePhoto(${index})">√ó</button>
`;
previewContainer.appendChild(photoItem);
};
reader.readAsDataURL(file);
});
}

function removePhoto(index) {
selectedFiles.splice(index, 1);
const previewContainer = document.getElementById('photo-preview');
previewContainer.innerHTML = '';
selectedFiles.forEach((file, i) => {
const reader = new FileReader();
reader.onload = function(e) {
const photoItem = document.createElement('div');
photoItem.className = 'photo-item';
photoItem.innerHTML = `
<img src="${e.target.result}" alt="–§–æ—Ç–æ">
<button class="photo-remove" onclick="removePhoto(${i})">√ó</button>
`;
previewContainer.appendChild(photoItem);
};
reader.readAsDataURL(file);
});
const dataTransfer = new DataTransfer();
selectedFiles.forEach(file => dataTransfer.items.add(file));
document.getElementById('images-input').files = dataTransfer.files;
}

document.getElementById('secondary-form').addEventListener('submit', async function(e) {
e.preventDefault();

if (!selectedFiles || selectedFiles.length === 0) {
showAlert('property-alert', '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ!', 'error');
return;
}

const formData = new FormData(e.target);
const submitBtn = document.getElementById('submit-btn');
const progressContainer = document.getElementById('upload-progress-container');
const progressBar = document.getElementById('progress-bar-inner');
const progressPercentage = document.getElementById('progress-percentage');
const uploadStatus = document.getElementById('upload-status');

formData.append('market', 'secondary');

progressContainer.style.display = 'block';
submitBtn.disabled = true;
submitBtn.innerHTML = 'üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...';

const xhr = new XMLHttpRequest();
xhr.timeout = 3000000;

xhr.upload.addEventListener('progress', function(event) {
if (event.lengthComputable) {
const percent = Math.round((event.loaded / event.total) * 100);
progressBar.style.width = `${percent}%`;
progressBar.textContent = `${percent}%`;
progressPercentage.textContent = `${percent}%`;
uploadStatus.textContent = `–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è: ${percent}% (${formatFileSize(event.loaded)} –∏–∑ ${formatFileSize(event.total)})`;
}
});

xhr.addEventListener('load', function() {
if (xhr.status === 200) {
try {
const result = JSON.parse(xhr.responseText);
if (result.success) {
uploadStatus.textContent = '‚úÖ –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –û–±—Ä–∞–±–æ—Ç–∫–∞...';
setTimeout(() => {
showAlert('property-alert', `‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ! –®–∏—Ñ—Ä: ${result.property_number}`, 'success');
progressContainer.style.display = 'none';
submitBtn.disabled = false;
submitBtn.innerHTML = '‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ';
document.getElementById('secondary-form').reset();
document.getElementById('photo-preview').innerHTML = '';
selectedFiles = [];
loadMyProperties();
}, 1000);
} else {
throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
}
} catch (error) {
uploadStatus.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
submitBtn.disabled = false;
submitBtn.innerHTML = '‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ';
}
} else {
uploadStatus.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (${xhr.status})`;
submitBtn.disabled = false;
submitBtn.innerHTML = '‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ';
}
});

xhr.addEventListener('error', function() {
uploadStatus.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
submitBtn.disabled = false;
submitBtn.innerHTML = '‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ';
});

xhr.addEventListener('timeout', function() {
uploadStatus.textContent = '‚è±Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (5 –º–∏–Ω—É—Ç).';
submitBtn.disabled = false;
submitBtn.innerHTML = '‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ';
});

xhr.open('POST', `${API_BASE}/secondary/create`, true);
xhr.setRequestHeader('Authorization', `Bearer ${authToken}`);
xhr.send(formData);
});

async function loadMyProperties() {
try {
const response = await fetch(`${API_BASE}/secondary/my-properties`, {
headers: {
'Authorization': `Bearer ${authToken}`
}
});
const properties = await response.json();
const listContainer = document.getElementById('properties-list');
const noProperties = document.getElementById('no-properties');

if (properties.length === 0) {
listContainer.innerHTML = '';
noProperties.style.display = 'block';
} else {
noProperties.style.display = 'none';
listContainer.innerHTML = properties.map(prop => `
<div class="property-card">
<div class="property-image" style="background-image: url('${prop.images[0]}')"></div>
<div class="property-info">
<div class="property-shifr">–®–∏—Ñ—Ä: ${prop.property_number}</div>
${prop.district ? `<div class="property-district">${prop.district}</div>` : ''}
<div class="property-title">${prop.title}</div>
<div class="property-price">${prop.price}</div>
<div class="property-address">${prop.address}</div>
<div class="property-actions">
<button class="btn btn-warning" onclick="editProperty(${prop.id})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="btn btn-danger" onclick="deleteProperty(${prop.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</div>
</div>
</div>
`).join('');
}
} catch (error) {
console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π:', error);
showAlert('properties-alert', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π', 'error');
}
}

async function deleteProperty(id) {
if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?')) {
return;
}

try {
const response = await fetch(`${API_BASE}/secondary/properties/${id}`, {
method: 'DELETE',
headers: {
'Authorization': `Bearer ${authToken}`
}
});
const result = await response.json();
if (result.success) {
showAlert('properties-alert', '‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
loadMyProperties();
} else {
showAlert('properties-alert', result.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
}
} catch (error) {
console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
showAlert('properties-alert', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
}
}

function editProperty(id) {
alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏.');
}

function formatFileSize(bytes) {
if (bytes === 0) return '0 –ë';
const k = 1024;
const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];
const i = Math.floor(Math.log(bytes) / Math.log(k));
return (bytes / Math.pow(k, i)).toFixed(1) + ' ' + sizes[i];
}
</script>
</body>
</html>